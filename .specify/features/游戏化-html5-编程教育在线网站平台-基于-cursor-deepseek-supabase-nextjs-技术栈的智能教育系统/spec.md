# Feature Specification: GameCode Lab - 游戏化HTML5编程教育平台

**Created**: 2025-10-15  
**Status**: Draft  
**Owner**: 开发团队

---

## 1. Overview

### 1.1 Feature Summary
GameCode Lab 是一个基于浏览器的游戏化在线编程学习平台，让零基础用户通过任务闯关、AI实时反馈、积分与成就机制，系统掌握 HTML5、CSS、JavaScript 等 Web 基础开发技能。平台提供1个月免费试用期，访客无需注册即可体验全部功能。

### 1.2 Problem Statement
传统编程教育存在以下痛点：
- 学习曲线陡峭，零基础用户难以入门
- 缺乏即时反馈，学习者难以知道自己的错误在哪里
- 学习过程枯燥，缺乏持续学习的动力
- 需要安装复杂的开发环境，门槛较高
- 缺少个性化的学习路径和智能辅导

本平台通过游戏化机制、AI智能辅导和浏览器内置代码沙盒，降低学习门槛，提升学习体验和效率。

### 1.3 Goals & Objectives
- **降低学习门槛**：零安装、零配置，在浏览器中即可开始学习编程
- **提升学习动力**：通过游戏化机制（等级、积分、成就、排行榜）增强学习趣味性
- **提供智能辅导**：AI助教提供实时代码讲解、错误诊断和个性化学习建议
- **培养实战能力**：从基础语法到完整项目，逐步培养独立开发能力
- **建设学习社区**：作品展示与交流，形成良性学习氛围

---

## 2. User Scenarios & Testing

### 2.1 Primary User Scenarios

#### Scenario 1: 游客试用体验
**Actor**: 首次访问的游客用户  
**Goal**: 了解平台功能并开始学习编程基础  
**Steps**:
1. 访问网站主页，看到清晰的"免费试用1个月"提示
2. 点击"开始学习"按钮，系统自动分配临时账号
3. 进入新手引导，了解平台基本操作
4. 选择第一个关卡"认识HTML标签"开始学习
5. 在代码编辑器中输入代码，实时看到预览效果
6. AI助教提供即时反馈和提示
7. 完成任务后获得经验值和成就徽章

**Expected Outcome**: 用户能够在5分钟内完成第一个编程任务，理解平台的学习模式，获得成就感  
**Edge Cases**: 
- 用户1个月试用期结束后，系统提示注册正式账号
- 用户中途关闭浏览器，再次访问时能够继续之前的进度
- 网络中断时，本地保存编辑内容，恢复后自动同步

#### Scenario 2: 学生用户闯关学习
**Actor**: 注册学生用户  
**Goal**: 系统学习HTML/CSS/JavaScript，从入门到实战  
**Steps**:
1. 登录账号，查看学习仪表板和当前等级
2. 选择学习路径中的下一个关卡
3. 阅读AI助教提供的知识讲解和示例代码
4. 在代码沙盒中完成编程任务
5. 提交代码，AI自动检测错误并提供修改建议
6. 修正错误后通过关卡，获得XP和金币奖励
7. 解锁新的关卡和功能（如编辑器主题、代码模板）
8. 查看学习曲线图和成就墙

**Expected Outcome**: 用户按照学习路径完成关卡，逐步掌握编程技能，能够追踪自己的学习进度和成长轨迹  
**Edge Cases**:
- 用户多次尝试仍无法通过关卡，AI提供更详细的提示或推荐回顾前置知识
- 用户跳过某些关卡，系统检测知识缺口并推荐补充学习
- 用户在某个难度停留过久，系统推荐调整学习节奏或寻求社区帮助

#### Scenario 3: AI助教智能辅导
**Actor**: 学习过程中遇到困难的用户  
**Goal**: 获得个性化的编程指导和错误解释  
**Steps**:
1. 用户在编写代码时遇到错误或不理解的概念
2. 点击"询问AI助教"按钮
3. 用户用自然语言描述问题，如"为什么我的按钮没有居中？"
4. AI分析用户的代码和问题
5. AI用简单易懂的语言解释错误原因
6. AI提供修改建议和参考代码
7. 用户根据建议修改代码，问题解决
8. AI记录用户的学习轨迹，优化后续推荐

**Expected Outcome**: 用户能够在1分钟内得到清晰的问题解答，理解错误原因并学会正确的写法  
**Edge Cases**:
- AI无法理解用户的问题描述，引导用户重新表述或提供代码上下文
- 用户的代码问题过于复杂，AI推荐查看相关教程或向社区求助
- AI检测到用户反复犯同样的错误，推荐针对性的复习内容

#### Scenario 4: 完成项目并分享作品
**Actor**: 已有一定基础的学生用户  
**Goal**: 完成一个完整的网页项目并分享给社区  
**Steps**:
1. 进入"综合实战"模块，选择项目挑战（如"制作个人主页"）
2. 查看项目需求和评分标准
3. 使用在线编辑器开发完整项目
4. 在开发过程中使用AI助教解决技术问题
5. 完成后提交作品，AI自动评分并给出反馈
6. 选择将作品发布到社区作品展示墙
7. 其他用户浏览、点赞、评论作品
8. 作品获得高赞后进入"每日精选"推荐

**Expected Outcome**: 用户能够独立完成一个可运行的网页项目，获得成就感和社区认可，激励继续学习  
**Edge Cases**:
- 用户项目不符合基本要求，AI提供改进建议并要求修改后重新提交
- 用户作品存在安全风险（如恶意脚本），系统自动拦截并提示修正
- 用户选择不公开作品，仅保存在个人作品集中

#### Scenario 5: 教师创建自定义课程
**Actor**: 教师用户  
**Goal**: 为学生创建定制化的学习内容和考核任务  
**Steps**:
1. 登录教师账号，进入课程管理页面
2. 点击"创建新课程"，填写课程基本信息
3. 使用关卡编辑器设计学习任务
4. 设置任务的代码模板、测试用例和评分标准
5. 邀请AI助手生成任务讲解和提示内容
6. 发布课程，生成课程链接或邀请码
7. 学生通过链接加入课程开始学习
8. 教师查看学生的学习进度和完成情况
9. 根据数据调整课程内容和难度

**Expected Outcome**: 教师能够在30分钟内创建一个包含5-10个任务的完整课程，学生能够顺利学习并完成任务  
**Edge Cases**:
- 教师设计的测试用例有误，系统提供测试和验证功能
- 学生普遍反馈某个任务过难，教师收到建议并可快速调整
- 课程被举报为不当内容，管理员审核并处理

### 2.2 User Types & Permissions

| User Type | Permissions | Use Cases |
|-----------|-------------|-----------|
| 游客 Guest | 1个月全功能试用、自动临时账号、完整课程访问、积分成就系统、作品保存（临时） | 体验平台功能、评估是否适合自己、零门槛开始学习 |
| 学生 Student | 完整账号体系、永久数据保存、学习进度追踪、AI助教无限访问、作品发布、社区互动、个人主页 | 系统化学习编程、构建作品集、参与社区交流 |
| 教师 Teacher | 学生所有权限 + 课程创建、关卡设计、任务发布、学生进度查看、课程数据分析 | 创建教学内容、管理班级学习、评估学生表现 |
| 管理员 Admin | 系统完整控制、AI引擎配置、课程审核、用户管理、数据统计、安全监控 | 平台运营维护、内容质量把控、系统优化 |

---

## 3. Functional Requirements

### 3.1 Core Functionality

**FR-1**: 用户认证与账号管理
- **Description**: 支持多种用户类型的注册、登录和权限管理，游客可免费试用1个月
- **Acceptance Criteria**:
  - [ ] 游客访问时自动分配临时账号，无需注册即可使用全部功能
  - [ ] 支持邮箱注册和第三方OAuth登录（Google、GitHub等）
  - [ ] 1个月试用期结束后，提示用户注册正式账号以保留数据
  - [ ] 临时账号可升级为正式账号，数据无缝迁移
  - [ ] 用户可查看和修改个人资料
  - [ ] 密码找回和重置功能
  - [ ] 不同用户类型具有对应的权限控制
- **Priority**: High

**FR-2**: HTML5课程体系与闯关系统
- **Description**: 提供从HTML基础到JS实战的完整学习路径，以关卡形式组织
- **Acceptance Criteria**:
  - [ ] 包含5大学习模块：Level 1 HTML5基础、Level 2 CSS样式、Level 3 JS基础、Level 4 DOM操作、Level 5 综合实战
  - [ ] 每个Level包含10-20个循序渐进的任务关卡
  - [ ] 关卡按顺序解锁，完成前置关卡才能进入后续关卡
  - [ ] 每个关卡包含：学习目标、知识讲解、代码示例、编程任务、测试用例
  - [ ] 支持关卡难度标识（简单、中等、困难、挑战）
  - [ ] 用户可重复挑战关卡以提升评分
  - [ ] 显示关卡完成率和通关进度
- **Priority**: High

**FR-3**: 在线代码编辑器与沙盒环境
- **Description**: 提供浏览器内置的三栏式代码编辑器，支持HTML/CSS/JS实时预览
- **Acceptance Criteria**:
  - [ ] 三栏布局：HTML编辑区、CSS编辑区、JavaScript编辑区
  - [ ] 实时预览窗口，代码修改后即时显示效果
  - [ ] 支持语法高亮和代码自动补全
  - [ ] 支持代码格式化和错误提示
  - [ ] 沙盒环境隔离，保证代码执行安全
  - [ ] 支持全屏编辑模式
  - [ ] 支持代码导入和导出
  - [ ] 移动端支持响应式布局
- **Priority**: High

**FR-4**: AI智能助教系统
- **Description**: 集成DeepSeek AI，提供代码讲解、错误诊断、智能对话等辅导功能
- **Acceptance Criteria**:
  - [ ] AI自动生成每个关卡的知识讲解内容
  - [ ] 用户提交代码后，AI自动检测语法和逻辑错误
  - [ ] AI用自然语言解释错误原因和修改建议
  - [ ] 支持聊天式编程指导，用户可用自然语言提问
  - [ ] AI根据用户学习轨迹提供个性化学习建议
  - [ ] AI自动出题生成小测验和挑战任务
  - [ ] AI对用户作品进行评分和优化建议
  - [ ] AI响应时间在3秒内
  - [ ] AI对话历史保存，方便用户回顾
- **Priority**: High

**FR-5**: 游戏化激励系统
- **Description**: 通过等级、经验值、金币、成就、排行榜等机制激励用户持续学习
- **Acceptance Criteria**:
  - [ ] 等级系统：从Lv1新手到Lv10大师，共10个等级
  - [ ] 经验值（XP）系统：完成任务获得XP，升级需要累计XP
  - [ ] 金币系统：完成任务和挑战获得金币，用于解锁皮肤和道具
  - [ ] 成就系统：包含30+种成就徽章（如"首次成功运行"、"连续学习7天"、"零错误通关"）
  - [ ] 全局排行榜：按XP、挑战速度、作品数量排名
  - [ ] 每日/每周/每月挑战任务
  - [ ] AI Boss对战：限时编程挑战，挑战成功获得额外奖励
  - [ ] 可定制的编辑器主题和界面元素
  - [ ] 学习统计仪表板：展示学习时长、完成关卡数、技能雷达图
- **Priority**: High

**FR-6**: 作品保存与管理
- **Description**: 用户可以保存编写的代码作品，并进行管理
- **Acceptance Criteria**:
  - [ ] 用户可保存任意数量的作品
  - [ ] 作品包含：标题、描述、HTML/CSS/JS代码、创建时间、修改时间
  - [ ] 支持作品版本管理，可回退到历史版本
  - [ ] 作品分类管理（按关卡、按类型）
  - [ ] 作品搜索和筛选功能
  - [ ] 作品导出为HTML文件
  - [ ] 游客的临时作品在试用期内保留，期满后提醒保存
- **Priority**: Medium

**FR-7**: 社区作品展示与互动
- **Description**: 用户可以将作品发布到社区，与其他用户交流互动
- **Acceptance Criteria**:
  - [ ] 用户可选择将作品发布到公开社区
  - [ ] 作品展示墙展示所有公开作品，支持按热度、时间、标签筛选
  - [ ] 用户可对作品点赞、收藏、评论
  - [ ] AI自动点评精选作品并推荐到"每日精选"
  - [ ] 作品详情页显示代码和实时预览
  - [ ] 用户可fork他人作品进行学习和改编
  - [ ] 作品举报和审核机制
  - [ ] 用户个人主页展示作品集和成就
- **Priority**: Medium

**FR-8**: 教师课程管理功能
- **Description**: 教师可创建自定义课程、设计关卡、管理学生学习
- **Acceptance Criteria**:
  - [ ] 教师可创建多个课程，每个课程包含多个关卡
  - [ ] 关卡编辑器支持设置：任务描述、代码模板、测试用例、评分标准
  - [ ] 可邀请AI生成关卡讲解内容和提示
  - [ ] 课程发布后生成唯一链接或邀请码
  - [ ] 学生通过链接加入课程
  - [ ] 教师仪表板显示学生学习进度、完成率、平均分
  - [ ] 教师可导出学生学习数据报告
  - [ ] 课程版本管理，可更新内容而不影响进行中的学生
- **Priority**: Medium

**FR-9**: 管理员系统管理功能
- **Description**: 管理员可管理平台内容、用户、AI配置和系统设置
- **Acceptance Criteria**:
  - [ ] 用户管理：查看、编辑、禁用用户账号
  - [ ] 课程审核：审核教师创建的公开课程
  - [ ] 内容审核：审核用户发布的社区作品和评论
  - [ ] AI引擎配置：设置API密钥、调整AI参数、监控API使用量
  - [ ] 系统数据统计：用户数、活跃度、课程完成率、AI调用量
  - [ ] 安全监控：检测恶意代码、异常行为、滥用行为
  - [ ] 系统配置：试用期时长、等级设置、积分规则
- **Priority**: Low

### 3.2 User Interface Requirements

**UIR-1**: 主页与导航
- **Description**: 清晰展示平台价值和核心功能，引导用户开始学习
- **Elements**: 
  - 头部导航栏（Logo、主要功能入口、用户状态）
  - 醒目的"免费试用1个月"横幅
  - 平台介绍和特色功能展示
  - "开始学习"主要行动按钮
  - 成功案例和用户评价
  - 底部信息（关于我们、帮助文档、联系方式）
- **Interactions**: 
  - 点击"开始学习"自动分配游客账号并进入课程页
  - 导航栏根据用户类型显示不同菜单
  - 滚动时头部导航固定显示
- **Responsive Behavior**: 移动端使用汉堡菜单，按钮尺寸放大，内容纵向排列

**UIR-2**: 学习仪表板
- **Description**: 用户登录后的主界面，展示学习进度和推荐内容
- **Elements**:
  - 用户信息卡片（头像、昵称、等级、XP进度条）
  - 学习路径可视化（5个Level的完成状态）
  - "继续学习"快捷入口（显示当前关卡）
  - 学习统计图表（学习时长、完成关卡数、技能雷达图）
  - 成就墙（已获得和未获得的成就徽章）
  - 每日挑战和推荐任务
  - 排行榜快照
- **Interactions**:
  - 点击Level图标展开关卡列表
  - 点击关卡进入学习页面
  - 悬停成就徽章显示获得条件和时间
- **Responsive Behavior**: 移动端卡片纵向堆叠，图表简化显示

**UIR-3**: 代码学习页面
- **Description**: 用户进行编程学习和实践的主界面
- **Elements**:
  - 左侧：任务面板（知识讲解、任务要求、提示）
  - 中间：三栏代码编辑器（HTML/CSS/JS可切换标签）
  - 右侧：实时预览窗口
  - 底部：AI助教对话框和控制按钮（提交、重置、保存、求助）
  - 顶部：关卡信息、进度条、返回按钮
- **Interactions**:
  - 拖动分隔条调整面板大小
  - 点击标签切换编辑语言
  - 点击"运行"实时更新预览
  - 点击"提交"触发AI评判
  - 点击"求助"打开AI对话
  - 代码编辑时自动保存草稿
- **Responsive Behavior**: 移动端使用标签页切换任务、代码、预览、AI助教四个视图

**UIR-4**: 社区作品展示页
- **Description**: 展示用户发布的公开作品，支持浏览和互动
- **Elements**:
  - 筛选和排序工具栏（热度、时间、标签）
  - 作品卡片网格（缩略图、标题、作者、点赞数）
  - "每日精选"推荐区
  - 搜索框
- **Interactions**:
  - 点击作品卡片进入作品详情页
  - 点击作者头像进入个人主页
  - 点赞、收藏、分享按钮
  - 无限滚动加载更多作品
- **Responsive Behavior**: 移动端单列显示，卡片全宽

**UIR-5**: 个人主页
- **Description**: 展示用户的学习成就和作品集
- **Elements**:
  - 用户信息（头像、昵称、等级、加入时间）
  - 学习成就总览（等级、XP、完成关卡数、学习天数）
  - 成就徽章展示
  - 作品集（公开作品展示）
  - 学习曲线图
- **Interactions**:
  - 用户可编辑自己的个人信息和头像
  - 点击作品进入详情页
  - 查看徽章获得时间和条件
- **Responsive Behavior**: 移动端内容纵向排列，图表简化

### 3.3 Data Requirements

**DR-1**: 用户数据
- **Description**: 存储用户账号信息、学习进度和个性化设置
- **Validation Rules**:
  - 邮箱格式验证
  - 密码强度要求（至少8位，包含字母和数字）
  - 昵称长度限制（2-20字符）
  - 头像文件大小限制（5MB以内）
- **Storage Requirements**: 
  - 用户基本信息永久保存
  - 游客临时账号数据保留1个月
  - 学习进度实时更新和保存
  - 已删除账号数据保留30天后永久删除

**DR-2**: 课程与关卡数据
- **Description**: 存储课程结构、关卡内容、测试用例
- **Validation Rules**:
  - 关卡标题不能为空
  - 测试用例必须可执行
  - 代码模板必须是有效的HTML/CSS/JS代码
- **Storage Requirements**:
  - 课程内容版本化存储
  - 支持课程内容的历史回溯
  - AI生成的讲解内容缓存以提高性能

**DR-3**: 作品数据
- **Description**: 存储用户创建的代码作品
- **Validation Rules**:
  - 代码总大小限制（单个作品不超过1MB）
  - 标题和描述长度限制
  - 恶意代码检测（XSS、无限循环等）
- **Storage Requirements**:
  - 用户作品永久保存
  - 作品版本历史保留最近10个版本
  - 未发布的草稿作品保留90天

**DR-4**: 学习行为数据
- **Description**: 记录用户的学习行为和进度，用于AI个性化推荐
- **Validation Rules**:
  - 时间戳必须有效
  - 行为类型必须在预定义列表中
- **Storage Requirements**:
  - 详细行为日志保留6个月
  - 聚合统计数据永久保存
  - 用户可请求删除个人行为数据

**DR-5**: 社区互动数据
- **Description**: 存储点赞、评论、收藏等社区互动信息
- **Validation Rules**:
  - 评论内容长度限制（1-500字符）
  - 评论内容敏感词过滤
  - 用户不能重复点赞同一作品
- **Storage Requirements**:
  - 互动数据永久保存
  - 已删除评论标记为删除但保留记录
  - 点赞数等统计信息实时更新

---

## 4. Non-Functional Requirements

### 4.1 Performance
- 页面首次加载时间不超过3秒
- 代码预览更新响应时间不超过500毫秒
- AI助教响应时间不超过3秒
- 支持同时在线1000名用户流畅学习
- 代码编辑器支持处理5000行代码不卡顿
- 数据库查询响应时间不超过100毫秒

### 4.2 Security
- 所有用户密码使用bcrypt加密存储
- 使用JWT进行用户身份验证
- 代码沙盒环境完全隔离，防止恶意代码影响系统
- 所有用户输入进行XSS和SQL注入防护
- API调用频率限制，防止滥用（每用户每小时最多100次AI调用）
- HTTPS加密传输
- 敏感信息（API密钥）使用环境变量存储，不提交到代码库
- 定期进行安全审计和漏洞扫描

### 4.3 Accessibility
- 符合WCAG 2.1 AA级标准
- 支持键盘导航，所有功能可通过Tab键和快捷键操作
- 代码编辑器支持屏幕阅读器
- 颜色对比度符合无障碍标准（至少4.5:1）
- 所有图片提供替代文本
- 支持字体大小调整
- 视频教程提供字幕

### 4.4 Usability
- 新用户可在5分钟内完成第一个编程任务
- 界面简洁直观，减少认知负担
- 错误提示清晰明确，提供解决建议
- 支持撤销/重做操作
- 关键操作提供确认提示，防止误操作
- 加载状态提供友好的动画提示
- 支持中英文双语切换
- 提供完整的帮助文档和新手引导

### 4.5 Reliability
- 系统可用性达到99.9%（每月停机时间不超过43分钟）
- 数据库每日自动备份
- 关键服务采用负载均衡和冗余部署
- 用户代码实时自动保存，防止意外丢失
- AI服务故障时提供降级方案（缓存回复或错误提示）

### 4.6 Scalability
- 系统架构支持横向扩展
- 数据库采用分片策略，支持大规模用户
- CDN加速静态资源加载
- AI API调用支持多供应商切换和负载均衡
- 缓存策略优化，减少数据库压力

---

## 5. Success Criteria

### 5.1 Quantitative Metrics
- **用户注册转化率**: 30%的游客用户在试用期内转化为注册用户
- **用户留存率**: 7日留存率达到40%，30日留存率达到20%
- **学习完成率**: 至少50%的活跃用户完成Level 1（HTML5基础）的全部关卡
- **用户活跃度**: 注册用户平均每周学习至少2次，每次学习时长超过15分钟
- **任务通过率**: 用户首次尝试任务的平均通过率达到60%以上
- **AI助教使用率**: 80%的用户在学习过程中至少使用1次AI助教功能
- **用户满意度**: 用户满意度调查评分达到4.2/5.0以上
- **作品发布率**: 完成Level 5的用户中，至少30%发布作品到社区
- **页面性能**: 95%的页面加载时间在3秒以内
- **系统可用性**: 每月正常运行时间达到99.9%

### 5.2 Qualitative Measures
- 用户反馈平台"容易上手"、"学习有趣"、"AI助教很有帮助"
- 用户能够独立完成从零开始的简单网页项目
- 用户表示相比传统学习方式，更愿意持续使用本平台
- 教师用户反馈课程管理功能满足教学需求
- 社区作品质量逐步提升，用户间互动活跃
- 用户推荐平台给朋友的NPS（净推荐值）达到40以上

---

## 6. Dependencies & Assumptions

### 6.1 Dependencies
- **AI服务**: 依赖DeepSeek API正常运行，需要稳定的API访问和合理的调用额度
- **数据库服务**: 依赖Supabase提供的PostgreSQL数据库、认证服务和Edge Functions
- **部署平台**: 依赖Netlify提供的Web托管和CDN服务
- **第三方登录**: 依赖Google、GitHub等OAuth服务提供商的API
- **浏览器兼容性**: 依赖现代浏览器支持（Chrome 90+、Firefox 88+、Safari 14+、Edge 90+）

### 6.2 Assumptions
- 目标用户具备基本的电脑操作能力和互联网访问
- 用户主要使用桌面浏览器学习，移动端作为辅助
- DeepSeek AI的代码理解和生成能力能够满足基础编程教学需求
- 大多数用户愿意花费15-30分钟完成单个关卡学习
- 游戏化机制能够有效激励用户持续学习
- 1个月的免费试用期足够用户评估平台价值
- 浏览器沙盒环境能够安全地运行用户代码
- 用户对AI反馈的准确性和有用性有合理预期
- 平台运营初期每日活跃用户数不超过1000人
- 用户主要学习目标是Web前端开发基础，暂不涉及后端和框架

### 6.3 Constraints
- **技术限制**: 浏览器沙盒环境仅支持纯前端代码（HTML/CSS/JS），不支持Node.js或服务器端功能
- **AI成本**: AI API调用有成本，需要限制每用户的调用频率（每小时100次）
- **数据存储**: 免费用户的作品存储空间限制为100MB
- **内容审核**: 社区作品和评论需要人工或AI辅助审核，可能有延迟
- **多语言支持**: 初始版本仅支持中文和英文，其他语言需要后续扩展
- **浏览器兼容性**: 不支持IE浏览器，需要用户使用现代浏览器
- **移动端功能**: 移动端主要用于浏览和简单编辑，复杂开发仍推荐桌面端
- **AI响应准确性**: AI助教可能出现理解错误或不准确的回答，需要人工反馈机制优化

---

## 7. Out of Scope

以下功能明确不包含在本版本中，可能在未来版本中考虑：

- **后端编程课程**: 不包含Python、Java、C++等后端语言教学
- **框架高级课程**: 不包含React、Vue、Angular等前端框架的深度教学
- **移动应用开发**: 不涉及iOS、Android原生开发或React Native
- **数据库编程**: 不包含SQL、NoSQL等数据库操作教学
- **算法与数据结构**: 不包含系统的算法课程
- **实时协作编程**: 不支持多人同时编辑同一份代码
- **视频通话/屏幕共享**: 不提供实时远程教学功能
- **证书与认证**: 不提供官方证书或职业认证
- **付费课程市场**: 不提供第三方付费课程交易平台
- **IDE插件集成**: 不开发VSCode、WebStorm等IDE插件
- **离线模式**: 不支持完全离线使用（需要网络连接访问AI和云端数据）
- **WebGPU图形编程**: 不包含3D图形编程教学（未来扩展方向）
- **AI代码生成整个项目**: AI助教仅提供辅导和建议，不直接生成完整项目代码

---

## 8. Key Entities

### Entity 1: User (用户)
**Attributes**:
- user_id: 唯一标识符
- email: 邮箱地址
- password_hash: 加密后的密码
- username: 用户昵称
- avatar_url: 头像URL
- user_type: 用户类型（guest/student/teacher/admin）
- level: 当前等级（1-10）
- experience_points: 经验值
- coins: 金币数量
- created_at: 注册时间
- trial_end_date: 试用期结束日期（游客用户）
- is_active: 账号是否激活

**Relationships**:
- 拥有多个作品（Works）
- 完成多个关卡（Levels/Tasks）
- 获得多个成就（Achievements）
- 创建多个课程（Courses，教师用户）
- 发布多条评论（Comments）
- 进行多次AI对话（AI Conversations）

### Entity 2: Course (课程)
**Attributes**:
- course_id: 唯一标识符
- course_name: 课程名称
- description: 课程描述
- level_number: 课程等级（1-5）
- order: 课程顺序
- is_official: 是否官方课程
- creator_id: 创建者ID（教师用户）
- created_at: 创建时间
- updated_at: 更新时间

**Relationships**:
- 包含多个关卡（Tasks）
- 由一个教师创建（User）
- 被多个学生学习（User）

### Entity 3: Task (关卡/任务)
**Attributes**:
- task_id: 唯一标识符
- course_id: 所属课程ID
- task_name: 任务名称
- description: 任务描述
- knowledge_content: 知识讲解内容（AI生成）
- code_template_html: HTML代码模板
- code_template_css: CSS代码模板
- code_template_js: JS代码模板
- test_cases: 测试用例（JSON格式）
- difficulty: 难度等级（easy/medium/hard/challenge）
- xp_reward: 完成奖励的经验值
- coins_reward: 完成奖励的金币
- order: 关卡顺序

**Relationships**:
- 属于一个课程（Course）
- 被多个用户完成（UserTaskProgress）
- 关联多个用户作品（Works）

### Entity 4: UserTaskProgress (用户关卡进度)
**Attributes**:
- progress_id: 唯一标识符
- user_id: 用户ID
- task_id: 关卡ID
- status: 状态（locked/in_progress/completed）
- attempts: 尝试次数
- best_score: 最高分数
- completion_time: 完成时间
- last_code_html: 最后保存的HTML代码
- last_code_css: 最后保存的CSS代码
- last_code_js: 最后保存的JS代码
- created_at: 开始时间
- updated_at: 最后更新时间

**Relationships**:
- 关联一个用户（User）
- 关联一个关卡（Task）

### Entity 5: Work (作品)
**Attributes**:
- work_id: 唯一标识符
- user_id: 用户ID
- task_id: 关联关卡ID（可选）
- title: 作品标题
- description: 作品描述
- code_html: HTML代码
- code_css: CSS代码
- code_js: JavaScript代码
- thumbnail_url: 缩略图URL
- is_public: 是否公开
- views_count: 浏览次数
- likes_count: 点赞数
- forks_count: Fork次数
- created_at: 创建时间
- updated_at: 更新时间

**Relationships**:
- 属于一个用户（User）
- 可能关联一个关卡（Task）
- 拥有多个版本（WorkVersions）
- 收到多条评论（Comments）
- 被多个用户点赞（UserLikes）
- 被多个用户收藏（UserFavorites）

### Entity 6: Achievement (成就)
**Attributes**:
- achievement_id: 唯一标识符
- name: 成就名称
- description: 成就描述
- icon_url: 徽章图标URL
- condition: 获得条件（JSON格式）
- xp_reward: 经验值奖励
- rarity: 稀有度（common/rare/epic/legendary）

**Relationships**:
- 被多个用户获得（UserAchievements）

### Entity 7: UserAchievement (用户成就)
**Attributes**:
- user_achievement_id: 唯一标识符
- user_id: 用户ID
- achievement_id: 成就ID
- earned_at: 获得时间

**Relationships**:
- 关联一个用户（User）
- 关联一个成就（Achievement）

### Entity 8: AIConversation (AI对话)
**Attributes**:
- conversation_id: 唯一标识符
- user_id: 用户ID
- task_id: 关联关卡ID（可选）
- messages: 对话消息列表（JSON格式，包含user和assistant消息）
- created_at: 创建时间
- updated_at: 最后更新时间

**Relationships**:
- 属于一个用户（User）
- 可能关联一个关卡（Task）

### Entity 9: Comment (评论)
**Attributes**:
- comment_id: 唯一标识符
- user_id: 用户ID
- work_id: 作品ID
- content: 评论内容
- parent_comment_id: 父评论ID（用于评论回复）
- is_deleted: 是否已删除
- created_at: 创建时间

**Relationships**:
- 属于一个用户（User）
- 关联一个作品（Work）
- 可能回复另一条评论（Comment）

### Entity 10: Leaderboard (排行榜)
**Attributes**:
- leaderboard_id: 唯一标识符
- user_id: 用户ID
- rank_type: 排名类型（xp/speed/works）
- score: 分数
- period: 时期（daily/weekly/monthly/all_time）
- updated_at: 更新时间

**Relationships**:
- 关联一个用户（User）

---

## 9. Decisions & Implementation Guidance

所有关键技术决策已完成，规格说明已就绪。

### Decision 1: AI API降级策略 ✅

**选择**: 自动切换到备用AI服务商

**实施方案**:
- 建立AI服务优先级列表：DeepSeek（主要）→ GLM → Moonshot → Tongyi → 其他备用
- 实现健康检查机制，每5分钟ping各AI服务标记可用状态
- 主服务失败时自动尝试下一个可用服务
- 缓存常见问题回复（缓存时间7天），缓存命中率目标30%
- 所有服务失败时返回缓存或友好错误提示
- 使用Supabase Edge Functions实现代理和降级逻辑

**影响**: 需要集成多个AI API，增加开发复杂度，但提供最佳用户体验和服务连续性

### Decision 2: 游客试用期数据迁移机制 ✅

**选择**: 提前7天温和提醒 + 自动迁移数据

**实施方案**:
- **提醒时机**:
  - 试用期剩余7天：仪表板顶部横幅提示
  - 剩余3天：登录时弹窗提醒（可关闭）
  - 剩余1天：登录时强提示
- **期满处理**: 自动切换为只读模式，可查看历史数据但不能编辑
- **数据迁移**: 注册时自动关联临时账号数据，无缝迁移所有进度、作品、成就
- **数据保留**: 试用期结束后数据保留30天，超期则永久删除

**影响**: 用户体验最好，给用户充足决策时间，降低压迫感，提高转化意愿

### Decision 3: 代码沙盒安全隔离策略 ✅

**选择**: iframe sandbox with comprehensive restrictions

**实施方案**:
- 使用iframe的sandbox属性：`sandbox="allow-scripts allow-same-origin"`
- Content Security Policy (CSP)限制：`default-src 'none'; script-src 'unsafe-inline'; style-src 'unsafe-inline';`
- **禁止项**: 弹窗、页面跳转、表单提交、访问外部资源
- **允许项**: 脚本执行（教学必需）、same-origin（DOM操作）
- **代码预检测** (Supabase Edge Function):
  - 检测无限循环（`while(true)`等）
  - 检测危险函数（`eval`, `Function`, `setTimeout`等）
  - 检测代码大小限制（1MB）
  - 检测外部资源请求
- **资源限制**: 执行超时5秒，浏览器自动管理内存

**影响**: 开发简单，性能好，适合HTML/CSS/JS教学，安全性满足教育场景需求

---

## 10. Approval & Sign-off

**Reviewed by**: [待审核]  
**Approved by**: [待批准]  
**Date**: [待定]

---

## Notes

- 本规格说明基于用户提供的详细需求文档编写，涵盖了GameCode Lab平台的完整功能定义
- 规格说明聚焦于"是什么"和"为什么"，不涉及具体技术实现细节
- 所有功能需求均可测试和验证
- 成功标准均为可衡量的指标，不依赖具体技术实现
- 环境变量和API密钥已在原需求中提供，将在后续技术实现阶段使用
- 本文档为技术无关的规格说明，适合业务方、产品经理、设计师和开发团队共同理解项目目标
